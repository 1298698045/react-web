(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[88],{Pjik:function(e,t,n){"use strict";n.r(t);n("y8nQ");var a=n("Vl3Y"),i=n("eHn4"),o=n.n(i),r=n("jehZ"),c=n.n(r),l=(n("+L6B"),n("2/Rp")),u=(n("BoS7"),n("Sdc0")),s=n("p0pE"),m=n.n(s),d=(n("Pwec"),n("CtXQ"),n("2qtc"),n("kLXV")),E=n("qIgq"),f=n.n(E),p=n("q1tI"),y=n.n(p),O=n("MuoO"),b=n("v99g"),k=n("myFP"),g=n("mGJS"),v=n("9vKQ"),I=(n("14J3"),n("BMrR")),P=(n("jCWc"),n("kPKH")),R=function(e){var t=e.selectedRow,n=e.onSubmit,i=e.visible,o=e.setVisible,r=e.form,l=e.loading,u=function(e){e.preventDefault(),r.validateFields(function(e,a){if(e)return!1;n(m()({},a,{id:t.id}))})},s=function(e){e.preventDefault(),o(!1)};return y.a.createElement(d["a"],{destroyOnClose:!0,title:(t[v["a"].EMPLOYEE.ID.key]?"\u4fee\u6539":"\u65b0\u589e")+"\u804c\u52a1",width:350,visible:i,onOk:u,onCancel:s,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:l,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},y.a.createElement(a["a"],{onSubmit:u},y.a.createElement(I["a"],{gutter:24},[v["a"].ORG.POSITION_NAME,v["a"].ORG.POSITION_LEVEL,m()({},v["a"].ORG.POSITION_TYPE,{status:t.id?"disabled":"edit"}),m()({},v["a"].ORG.POSITION_MEMO,{notRequired:!0})].map(function(n){return y.a.createElement(P["a"],{xs:24,key:n.key},y.a.createElement(g["a"],c()({},e,{config:n,form:r,initialValue:t[n.key],rules:[{required:!n.notRequired,message:"\u8be5\u9879\u4e3a\u5fc5\u586b"}],style:{marginBottom:0},status:n.status})))}))))},_=a["a"].create()(R),T=n("03Mi"),S=n("uY7g"),L="orgPosition",M=function(e){var t=e.dispatch,n=e.form,a=e.loading,i=(e.departmentSelected,Object(p["useState"])(!1)),o=f()(i,2),r=o[0],s=o[1],d=Object(p["useState"])({}),E=f()(d,2),O=E[0],I=E[1],P=Object(p["useState"])(!1),R=f()(P,2),M=R[0],h=R[1],D=function(e){return t({type:"".concat(L,"/savePosition"),params:e}).then(function(){h(!0),Object(T["e"])(t,"position_id")})},A=function(e,t){return D({id:e,status:t?1:0})},C=[m()({},v["a"].ORG.POSITION_NAME,{customRender:function(e,t,n){return y.a.createElement(S["a"],{privs:["position_edit"],noMatch:e},y.a.createElement("a",{onClick:function(e){I(m()({},t)),s(!0)}},e))}}),v["a"].ORG.POSITION_TYPE,v["a"].ORG.POSITION_LEVEL,v["a"].ORG.POSITION_MEMO,m()({},v["a"].ORG.POSITION_STATUS,{customRender:function(e,t){return y.a.createElement(S["a"],{privs:["position_status_swtich"],noMatch:1==e?"\u542f\u7528":"\u5173\u95ed"},y.a.createElement(u["a"],{checkedChildren:"\u542f\u7528",unCheckedChildren:"\u5173\u95ed",checked:1==e,onChange:function(e){return A(t.id,e)}}))}})],N=[{config:v["a"].ORG.POSITION_TYPE},{config:v["a"].ORG.POSITION_LEVEL},{config:v["a"].ORG.POSITION_STATUS}],G=[y.a.createElement(S["a"],{privs:["position_add"],key:"position_add"},y.a.createElement(l["a"],{key:"input",icon:"plus-circle",htmlType:"button",type:"primary",onClick:function(){I({}),s(!0)}},"\u65b0\u589e\u804c\u52a1"))],j=Object(p["useMemo"])(function(){return N.map(function(e){return y.a.createElement(g["a"],c()({},e,{form:n}))})},[n]);return y.a.createElement(p["Fragment"],null,y.a.createElement(b["a"],null,y.a.createElement(k["a"],c()({},e,{tableName:L,originColumns:C,formFields:j,tableActions:G,columnSortable:!1,needUpdate:M,setNeedUpdate:h}))),y.a.createElement(_,{selectedRow:O,visible:r,setVisible:s,loading:a.effects["".concat(L,"/savePosition")],onSubmit:function(e){console.log(e),D(e).then(function(e){!1!==e&&s(!1)})}}))};t["default"]=Object(O["connect"])(function(e){var t,n=e[L],a=e.loading,i=e.global;return t={},o()(t,L,n),o()(t,"loading",a),o()(t,"global",i),t})(a["a"].create()(M))},WT9R:function(e,t,n){"use strict";n.r(t);n("IzEo");var a=n("bx4M"),i=(n("T2oS"),n("W9HT")),o=(n("+L6B"),n("2/Rp")),r=(n("2qtc"),n("kLXV")),c=n("qIgq"),l=n.n(c),u=(n("ozfa"),n("MJZm")),s=n("q1tI"),m=n.n(s),d=n("MuoO"),E=(n("y8nQ"),n("Vl3Y")),f=(n("14J3"),n("BMrR")),p=(n("jCWc"),n("kPKH")),y=n("jehZ"),O=n.n(y),b=n("eHn4"),k=n.n(b),g=n("p0pE"),v=n.n(g),I=n("mGJS"),P=n("9vKQ"),R=n("03Mi"),_=function(e){var t=e.dispatch,n=e.selectedRow,a=e.onSubmit,i=e.visible,o=e.setVisible,c=e.form,u=e.loading,d=Object(s["useState"])(),y=l()(d,2),b=y[0],g=y[1],_=Object(s["useState"])([]),T=l()(_,2),S=T[0],L=T[1];Object(s["useEffect"])(function(){Object(R["d"])(t,"depart_id").then(function(e){console.log("************",e),L(e.filter(function(e){return e.dKey!=n.id}))})},[i]);var M=function(e){e.preventDefault(),c.validateFields(function(e,t){if(e)return!1;a(v()({},t,k()({},P["a"].ORG.DEPART_ID.key,n[P["a"].ORG.DEPART_ID.key])))})},h=function(e){e.preventDefault(),o(!1)},D=function(e,t){e===P["a"].ORG.DEPART_TYPE.key&&g(t)};return m.a.createElement(r["a"],{destroyOnClose:!0,title:(n[P["a"].ORG.DEPART_ID.key]?"\u4fee\u6539":"\u65b0\u589e")+"\u7ec4\u7ec7\u67b6\u6784",visible:i,onOk:M,onCancel:h,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:u,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},m.a.createElement(E["a"],{onSubmit:M},m.a.createElement(f["a"],{gutter:24},[P["a"].ORG.DEPART_TYPE,P["a"].ORG.DEPART_NAME,v()({},P["a"].ORG.DEPART_PARENT,{notRequired:!0,hidden:"school"===b,values:S}),P["a"].ORG.DEPART_ORDER,v()({},P["a"].ORG.DEPART_MEMO,{notRequired:!0})].map(function(t){return!t.hidden&&m.a.createElement(p["a"],{xs:24,key:t.key},m.a.createElement(I["a"],O()({},e,{config:t,form:c,initialValue:n[t.key]||void 0,rules:[{required:!t.notRequired,message:"\u8be5\u9879\u4e3a\u5fc5\u586b"}],style:{marginBottom:0},onChange:D,values:t.values})))}))))},T=E["a"].create()(_),S=n("v99g"),L=n("myFP"),M=n("o8it"),h=(n("kZwo"),n("wd/R"),function(e){var t=e.actionType,n=e.employeeId,a=e.dispatch,o=(e.dictionary,e.employee),c=e.onSubmit,u=e.visible,d=e.setVisible,f=e.form,p=e.loading,y=e.confirmLoading,b=(e.departId,Object(s["useState"])({})),g=l()(b,2),_=g[0],T=g[1],S=Object(s["useState"])(),L=l()(S,2);L[0],L[1];Object(s["useEffect"])(function(){n&&u?(a({type:"orgEmployee/doGetAllCarList"}),a({type:"orgEmployee/doGetUnbindCarList"}),Object(R["d"])(a,"role_id"),a({type:"orgEmployee/queryEmployeeInfo",params:{employeeId:n}}).then(function(e){!1!==e&&T(e)})):n||T({})},[u]);var M=function(e){e.preventDefault(),f.validateFields(function(e,t){if(e)return!1;c(v()({},_,t,k()({},P["a"].EMPLOYEE.ID.key,_[P["a"].EMPLOYEE.ID.key])))})},h=function(e){e.preventDefault(),d(!1)},D=Object(s["useMemo"])(function(){if(!o.allCars||!o.unbindCars)return[];_.carIds||(_.carIds=[]);var e=o.allCars.filter(function(e){return _.carIds.indexOf(e.id)>-1||"normal"===e.carStatus&&o.unbindCars.find(function(t){return t.id===e.id})});return e.map(function(e){return{dKey:String(e.id),dValue:e.plateNo}})},[o.allCars,o.unbindCars,_.carIds]),A=[v()({},P["a"].EMPLOYEE.ROLE_ID_ACTIVE,{mode:"multiple",notRequired:!0})];return"car"===t&&(A=[v()({},P["a"].EMPLOYEE.CAR_ID,{values:D,mode:"multiple",notRequired:!0})]),m.a.createElement(r["a"],{destroyOnClose:!0,title:"car"===t?"\u7ed1\u5b9a\u8f66\u8f86":"\u5206\u914d\u89d2\u8272",visible:u,onOk:M,onCancel:h,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:y,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},m.a.createElement(i["a"],{spinning:p.effects["orgEmployee/queryEmployeeInfo"]||p.effects["dictionary/position_id"]||!1},m.a.createElement(E["a"],{onSubmit:M},A.map(function(t){return m.a.createElement(I["a"],O()({key:t.key},e,{config:t,mode:t.mode,maxTagCount:3,form:f,initialValue:t.initialValue||_[t.key],values:t.values,style:{marginBottom:0},status:t.status}))}))))}),D=Object(d["connect"])(function(e){var t=e.orgEmployee,n=e.dictionary,a=e.loading,i=e.global;return{employee:t,dictionary:n,loading:a,global:i}})(E["a"].create()(h)),A=n("tS4M"),C=n("uY7g"),N=n("vEAl"),G=n.n(N),j="orgEmployee",Y=function(e){var t=e.dispatch,n=e.form,a=e.loading,i=e.departmentSelected,c=e.quickEntryParams,u=Object(s["useState"])([]),d=l()(u,2),E=d[0],f=d[1],p=Object(s["useState"])(!1),y=l()(p,2),b=y[0],k=y[1],g=Object(s["useState"])({}),_=l()(g,2),T=_[0],h=_[1],N=Object(s["useState"])(!1),Y=l()(N,2),V=Y[0],q=Y[1],x=Object(s["useState"])(!1),w=l()(x,2),z=w[0],F=w[1],B=Object(s["useState"])(!1),K=l()(B,2),J=K[0],U=K[1];Object(A["useEffectOnce"])(function(){"addEmployee"===c&&(h({}),k(!0)),t({type:"quickEntryParams/clearParams"})});var H=function(e){return t({type:"".concat(j,"/saveEmployeeEdit"),params:e}).finally(function(e){q(!0),Object(R["e"])(t,"employee_id")})},Q=function(e){return t({type:"".concat(j,"/preLeave"),params:{employeeId:e[P["a"].EMPLOYEE.ID.key]}}).finally(function(){q(!0)})},Z=function(e){return t({type:"".concat(j,"/cancelPreLeave"),params:{employeeId:e[P["a"].EMPLOYEE.ID.key]}}).finally(function(){q(!0)})},W=function(e){return t({type:"".concat(j,"/confirmPreLeave"),params:{employeeId:e[P["a"].EMPLOYEE.ID.key]}}).finally(function(){q(!0)})},X=[v()({},P["a"].EMPLOYEE.NAME,{customRender:function(e,t,n){return m.a.createElement(C["a"],{privs:["employee_detail"],noMatch:e},m.a.createElement("a",{onClick:function(e){h(v()({},t)),k(!0)}},e))}}),P["a"].EMPLOYEE.MOBILE,P["a"].EMPLOYEE.POSITION_ID,P["a"].EMPLOYEE.DEPART_ID,v()({},P["a"].EMPLOYEE.CAR_ID,{customRender:function(e,t,n){return t.cars?t.cars.map(function(e){return m.a.createElement("div",{key:e.id},e.plateNo)}):""}}),P["a"].EMPLOYEE.ROLE_ID,v()({},P["a"].EMPLOYEE.LEAVING)],$=[{config:P["a"].EMPLOYEE.POSITION_ID_ACTIVE},{config:P["a"].EMPLOYEE.POSITION_TYPE},{config:P["a"].EMPLOYEE.QUICK_SEARCH},{config:v()({},P["a"].EMPLOYEE.LEAVING,{title:"\u5458\u5de5\u72b6\u6001"})}],ee=[m.a.createElement(C["a"],{privs:["employee_add"],key:"employee_add"},m.a.createElement(o["a"],{key:"input",icon:"plus-circle",htmlType:"button",type:"primary",onClick:function(){h({}),k(!0)}},"\u65b0\u589e\u5458\u5de5")),m.a.createElement(C["a"],{privs:["binding_cars"],key:"binding_cars"},m.a.createElement(o["a"],{type:"primary",key:"car",icon:"car",disabled:!E.length||0!=E[0][P["a"].EMPLOYEE.LEAVING.key],onClick:function(){h(v()({},E[0])),U("car"),F(!0)}},"\u7ed1\u5b9a\u8f66\u8f86")),m.a.createElement(C["a"],{privs:["add_roles"],key:"add_roles"},m.a.createElement(o["a"],{type:"primary",key:"role",icon:"fork",disabled:!E.length||0!=E[0][P["a"].EMPLOYEE.LEAVING.key],onClick:function(){h(v()({},E[0])),U("role"),F(!0)}},"\u5206\u914d\u89d2\u8272")),m.a.createElement(C["a"],{privs:["employee_pre_leave"],key:"employee_pre_leave"},m.a.createElement(o["a"],{type:"primary",key:"preLeave",icon:"logout",disabled:!E.length||0!=E[0][P["a"].EMPLOYEE.LEAVING.key],onClick:function(){return r["a"].confirm({title:"\u662f\u5426\u529e\u7406\u3010"+E[0][P["a"].EMPLOYEE.NAME.key]+"\u3011\u9884\u79bb\u804c\uff1f",content:"\u6559\u7ec3\u5458\u9884\u79bb\u804c\u540e\uff0c\u6240\u6709\u672a\u88ab\u9884\u7ea6\u7684\u8bfe\u5c06\u81ea\u52a8\u5173\u95ed\u3002",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){return Q(E[0]).then(function(){return f([])})}})}},"\u9884\u79bb\u804c")),m.a.createElement(C["a"],{privs:["employee_pre_leave_cancel"],key:"employee_pre_leave_cancel"},m.a.createElement(o["a"],{type:"primary",key:"cancel",icon:"rollback",disabled:!E.length||1!=E[0][P["a"].EMPLOYEE.LEAVING.key],onClick:function(){return r["a"].confirm({title:"\u662f\u5426\u64a4\u56de\u3010"+E[0][P["a"].EMPLOYEE.NAME.key]+"\u3011\u7684\u9884\u79bb\u804c\uff1f",content:"\u6559\u7ec3\u5458\u64a4\u56de\u540e\uff0c\u6240\u6709\u8bfe\u7a0b\u5c06\u81ea\u52a8\u6253\u5f00\u3002",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){return Z(E[0]).then(function(){return f([])})}})}},"\u64a4\u9500\u9884\u79bb\u804c")),m.a.createElement(C["a"],{privs:["employee_leave_comfrim"],key:"employee_leave_comfrim"},m.a.createElement(o["a"],{type:"primary",key:"leave",icon:"logout",disabled:!E.length||1!=E[0][P["a"].EMPLOYEE.LEAVING.key],onClick:function(){return r["a"].confirm({title:"\u662f\u5426\u529e\u7406\u3010"+E[0][P["a"].EMPLOYEE.NAME.key]+"\u3011\u79bb\u804c\uff1f",content:"\u529e\u7406\u79bb\u804c\u540e\u5c06\u65e0\u6cd5\u64a4\u56de\uff01",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){return W(E[0]).then(function(){return f([])})}})}},"\u786e\u8ba4\u79bb\u804c"))],te=Object(s["useMemo"])(function(){return $.map(function(e){return m.a.createElement(I["a"],O()({},e,{form:n}))})},[n]),ne=Object(s["useMemo"])(function(){return i.id?i[P["a"].ORG.DEPART_NAME.key]:"\u6240\u6709\u5458\u5de5"},[i]);return m.a.createElement(s["Fragment"],null,m.a.createElement("div",{className:G.a.card},m.a.createElement("div",{className:G.a.title},ne),m.a.createElement(S["a"],null,m.a.createElement(L["a"],O()({},e,{tableName:j,originColumns:X,formFields:te,tableActions:ee,multipleSelection:!1,selectedRows:E,setSelectedRows:f,columnSortable:!1,scroll:{x:"max-content"},tableSearchParams:{departId:i[P["a"].ORG.DEPART_ID.key],includeSubDepart:!0},needUpdate:V,setNeedUpdate:q})))),m.a.createElement(M["a"],{departId:i[P["a"].ORG.DEPART_ID.key],employeeId:T.id,visible:b,setVisible:k,confirmLoading:a.effects["".concat(j,"/saveEmployeeEdit")],onSubmit:function(e){console.log(e),H(e).then(function(e){!1!==e&&k(!1)})}}),m.a.createElement(D,{actionType:J,employeeId:T.id,visible:z,setVisible:F,confirmLoading:a.effects["".concat(j,"/saveEmployeeEdit")],onSubmit:function(e){console.log(e),H(e).then(function(e){!1!==e&&F(!1)})}}))},V=Object(d["connect"])(function(e){var t,n=e[j],a=e.quickEntryParams,i=e.loading,o=e.global;return t={},k()(t,j,n),k()(t,"quickEntryParams",a),k()(t,"loading",i),k()(t,"global",o),t})(E["a"].create()(Y)),q=u["a"].TreeNode,x=function(e){var t=e.dispatch,n=e.loading,c=e.organization,d=c.departments,E=Object(s["useState"])({}),f=l()(E,2),p=f[0],y=f[1],O=Object(s["useState"])(!1),b=l()(O,2),k=b[0],g=b[1],v=Object(s["useState"])({}),I=l()(v,2),_=I[0],S=I[1],L=function(){t({type:"organization/queryDepartmentList"}).then(function(){y({}),Object(R["e"])(t,"depart_id")})};Object(s["useEffect"])(L,[]);var M=Object(s["useMemo"])(function(){var e={};return function t(n){n.forEach(function(n){e[n[P["a"].ORG.DEPART_ID.key]]=n,n.children&&t(n.children)})}(d),e},[d]),h=Object(s["useMemo"])(function(){function e(t){return t&&t.map(function(t){return m.a.createElement(q,{title:t[P["a"].ORG.DEPART_NAME.key],key:t[P["a"].ORG.DEPART_ID.key]},e(t.children))})}return d.length?m.a.createElement(u["a"],{showLine:!0,defaultExpandAll:!0,onSelect:function(e){return y(M[e[0]]||{})}},e(d)):m.a.createElement("div",null,"\u6682\u65e0\u6570\u636e")},[d]),D=function(e){return t({type:"organization/saveDepartment",params:e}).then(L)},A=function(){r["a"].confirm({title:"\u5220\u9664\u7ec4\u7ec7\u67b6\u6784",content:"\u786e\u5b9a\u8981\u5220\u9664\u3010"+p[P["a"].ORG.DEPART_NAME.key]+"\u3011\u5417\uff1f",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){return N(p)},onCancel:function(){}})},N=function(e){return t({type:"organization/deleteDepartment",params:{departId:e[P["a"].ORG.DEPART_ID.key]}}).then(L)};return m.a.createElement(s["Fragment"],null,m.a.createElement("div",{className:G.a.main},m.a.createElement(a["a"],{style:{width:"309px"},className:G.a.leftSchool,size:"middle",bordered:!1,title:[m.a.createElement(C["a"],{privs:["department_add"],key:"department_add"},m.a.createElement(o["a"],{type:"primary",icon:"plus-circle",key:"add",onClick:function(e){S({}),g(!0)}},"\u65b0\u589e")),m.a.createElement(C["a"],{privs:["department_edit"],key:"department_edit"},m.a.createElement(o["a"],{type:"primary",icon:"edit",key:"edit",disabled:!p[P["a"].ORG.DEPART_ID.key],onClick:function(e){S(p),g(!0)}},"\u7f16\u8f91")),m.a.createElement(C["a"],{privs:["department_delete"],key:"department_delete"},m.a.createElement(o["a"],{type:"primary",icon:"delete",key:"delete",disabled:!p[P["a"].ORG.DEPART_ID.key],onClick:A},"\u5220\u9664"))]},m.a.createElement(i["a"],{spinning:n.effects["organization/queryDepartmentList"]||!1},h)),m.a.createElement("div",{className:G.a.right},m.a.createElement(V,{departmentSelected:p}))),m.a.createElement(T,{dispatch:t,selectedRow:_,visible:k,setVisible:g,loading:n.effects["organization/saveDepartment"],onSubmit:function(e){D(e).then(function(e){!1!==e&&g(!1)})}}))};t["default"]=Object(d["connect"])(function(e){var t=e.organization,n=e.loading,a=e.global;return{organization:t,loading:n,global:a}})(x)},ZJc0:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),i=n.n(a),o=n("zHco"),r=n("Y2fQ"),c=n("usdK"),l=function(e){var t=e.match,n=e.children,a=e.location,l=(e.dispatch,[{priv:"employee_manage",key:"org",tab:"\u7ec4\u7ec7\u67b6\u6784"},{priv:"position_manage",key:"position",tab:"\u804c\u52a1\u7ba1\u7406"}]),u=function(e){c["a"].push("".concat(t.url,"/").concat(e))};return i.a.createElement(o["a"],{title:i.a.createElement(r["FormattedMessage"],{id:"menu.school.organization"}),tabList:l,tabActiveKey:a.pathname.replace("".concat(t.path,"/"),""),onTabChange:u},n)};t["default"]=l}}]);