(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[150],{kqNx:function(e,t,n){"use strict";n.r(t);n("y8nQ");var a=n("Vl3Y"),i=n("eHn4"),r=n.n(i),l=n("jehZ"),c=n.n(l),o=(n("+L6B"),n("2/Rp")),m=(n("P2fV"),n("NJEC")),s=(n("T2oS"),n("W9HT")),u=(n("BoS7"),n("Sdc0")),d=(n("+BJd"),n("mr32")),g=(n("/zsF"),n("PArb")),f=n("p0pE"),p=n.n(f),E=n("qIgq"),y=n.n(E),T=(n("tU7J"),n("wFql")),b=n("q1tI"),k=n.n(b),v=n("6y2Z"),h=n("MuoO"),R=n("zHco"),S=n("Y2fQ"),C=n("v99g"),F=n("myFP"),L=n("9vKQ"),H=n("03Mi"),I=n("uY7g"),N=(n("3wSE"),n("2qtc"),n("kLXV")),O=(n("IzEo"),n("bx4M")),x=(n("14J3"),n("BMrR")),V=(n("Pwec"),n("CtXQ")),Y=(n("jCWc"),n("kPKH")),M=n("gWZ8"),B=n.n(M),A=(n("miYZ"),n("tsqr")),D=n("wd/R"),K=n.n(D),_=n("mGJS"),j=n("zYou"),q=n.n(j),w=n("hEdC"),G=0,J=-1,P=-1,z=function(e){var t=e.onSubmit,n=e.visible,i=e.setVisible,r=e.form,l=e.loading,c=e.afterClose,s=r.getFieldDecorator,u=r.getFieldValue;Object(w["a"])(function(){n||(G=0,J=-1,P=-1,r.resetFields())},[n,r]),Object(b["useEffect"])(function(){n&&v()},[n]);var d=function(e){e.preventDefault(),r.validateFields(function(e,n){if(e)return!1;var a=n.keys,i=n.timeRangeKeys,r=n.p,l=n.e,c=n.pBeginMonth,o=n.pTitle,m=n.pEndMonth,s=a.map(function(e){return{title:o[e],dateRange:[c[e],m[e]],timeRange:i[e].map(function(t){var n=r[e][t],a=n.beginTime,i=n.endTime;return[K()(a).format("HH:mm"),K()(i).format("HH:mm")]}),extTimeRange:y[e].map(function(t){var n=l[e][t],a=n.beginTime,i=n.endTime;return[K()(a).format("HH:mm"),K()(i).format("HH:mm")]})}}),u=s.filter(function(e){return!e.timeRange.length||e.timeRange.find(function(e){return"Invalid date"===e[0]||"Invalid date"===e[1]})}),d=s.filter(function(e){return e.extTimeRange.find(function(e){return"Invalid date"===e[0]||"Invalid date"===e[1]})});if(u.length>0)return A["a"].error("\u8bf7\u914d\u7f6e\u6b63\u5e38\u65f6\u6bb5\uff01"),!1;if(d.length>0)return A["a"].error("\u8bf7\u914d\u7f6e\u52a0\u73ed\u65f6\u6bb5\uff01"),!1;var g=B()(s);if(!g.length)return A["a"].error("\u8bf7\u6dfb\u52a0\u5468\u671f\uff01"),!1;g=g.map(function(e){return e.timeRange.length&&e.timeRange.sort(function(e,t){return 1*e[1].replace(":","")-1*t[1].replace(":","")}),e.extTimeRange.length&&e.extTimeRange.sort(function(e,t){return 1*e[1].replace(":","")-1*t[1].replace(":","")}),e}),t({params:{title:n[L["a"].TEACHING.LESSON.TITLE.key],periodList:g}})})},f=function(e){e.preventDefault(),i(!1)};s("keys",{initialValue:[]}),s("timeRangeKeys",{initialValue:[]}),s("exTimeRangeKeys",{initialValue:[]});var p=u("keys"),E=u("timeRangeKeys"),y=u("exTimeRangeKeys"),T=p.map(function(e,t){return k.a.createElement(b["Fragment"],{key:e},0!==t&&k.a.createElement(g["a"],{dashed:!0}),k.a.createElement(x["a"],{gutter:24},k.a.createElement(Y["a"],{md:6,sm:20},k.a.createElement(_["a"],{config:{title:"\u5468\u671f\u540d\u79f0",key:"pTitle[".concat(e,"]"),type:"input"},form:r,rules:[{required:!0}],style:{marginBottom:10}})),k.a.createElement(Y["a"],{sm:4},k.a.createElement(m["a"],{title:"\u786e\u8ba4\u5220\u9664\u8fd9\u4e2a\u5468\u671f\u4e48\uff1f",onConfirm:function(){return S(e)}},k.a.createElement(V["a"],{style:{marginTop:30},className:q.a.dynamicDeleteButton,type:"minus-circle-o"}))),k.a.createElement(Y["a"],{sm:24},k.a.createElement(a["a"].Item,{label:"\u5468\u671f\u8303\u56f4",required:!0,style:{marginBottom:10}},k.a.createElement(x["a"],{gutter:24},k.a.createElement(Y["a"],{md:12,sm:24},k.a.createElement(_["a"],{config:{title:"\u8d77\u59cb\u6708\u4efd",key:"pBeginMonth[".concat(e,"]"),type:"input"},needLabel:!1,form:r,addonBefore:"\u8d77\u59cb\u6708\u4efd",rules:[{required:!0}],style:{marginBottom:0}})),k.a.createElement(Y["a"],{md:12,sm:24},k.a.createElement(_["a"],{config:{title:"\u7ec8\u6b62\u6708\u4efd",key:"pEndMonth[".concat(e,"]"),type:"input"},needLabel:!1,form:r,addonBefore:"\u7ec8\u6b62\u6708\u4efd",rules:[{required:!0}],style:{marginBottom:0}}))))),k.a.createElement(Y["a"],{sm:24},k.a.createElement(a["a"].Item,{label:"\u6b63\u5e38\u65f6\u6bb5",required:!0},E[e]&&E[e].map(function(t,n){return k.a.createElement(x["a"],{gutter:24,key:n},k.a.createElement(Y["a"],{sm:10},k.a.createElement(_["a"],{config:{title:"\u8d77\u59cb\u65f6\u95f4",key:"p[".concat(e,"][").concat(t,"].beginTime"),type:"time"},onOpenChange:function(n){if(n){var a=r.getFieldValue("p"),i=a[e][t];i.beginTime||(i.beginTime=K()("".concat(K()().format("YYYY-MM-DD HH"),":00")),r.setFieldsValue({p:a}))}},needLabel:!1,form:r})),k.a.createElement(Y["a"],{sm:10},k.a.createElement(_["a"],{config:{title:"\u7ec8\u6b62\u65f6\u95f4",key:"p[".concat(e,"][").concat(t,"].endTime"),type:"time"},onOpenChange:function(n){if(n){var a=r.getFieldValue("p"),i=a[e][t];i.endTime||(i.endTime=K()("".concat(K()().format("YYYY-MM-DD HH"),":00")),r.setFieldsValue({p:a}))}},needLabel:!1,form:r})),k.a.createElement(Y["a"],{sm:4},k.a.createElement(m["a"],{title:"\u786e\u8ba4\u5220\u9664\u8fd9\u4e2a\u65f6\u6bb5\u4e48\uff1f",onConfirm:function(){return C(t,e)}},k.a.createElement(V["a"],{className:q.a.dynamicDeleteButton,type:"minus-circle-o"}))))}),k.a.createElement(o["a"],{block:!0,type:"dashed",onClick:function(){return h(e)},icon:"plus-circle-o"},"\u6dfb\u52a0\u6b63\u5e38\u65f6\u6bb5"))),k.a.createElement(Y["a"],{sm:24},k.a.createElement(a["a"].Item,{label:"\u52a0\u73ed\u65f6\u6bb5"},y[e]&&y[e].length>0&&y[e].map(function(t,n){return k.a.createElement(x["a"],{gutter:24,key:n},k.a.createElement(Y["a"],{sm:10},k.a.createElement(_["a"],{config:{title:"\u8d77\u59cb\u65f6\u95f4",key:"e[".concat(e,"][").concat(t,"].beginTime"),type:"time"},needLabel:!1,onOpenChange:function(n){if(n){var a=r.getFieldValue("e"),i=a[e][t];i.beginTime||(i.beginTime=K()("".concat(K()().format("YYYY-MM-DD HH"),":00")),r.setFieldsValue({e:a}))}},form:r})),k.a.createElement(Y["a"],{sm:10},k.a.createElement(_["a"],{config:{title:"\u7ec8\u6b62\u65f6\u95f4",key:"e[".concat(e,"][").concat(t,"].endTime"),type:"time"},onOpenChange:function(n){if(n){var a=r.getFieldValue("e"),i=a[e][t];i.endTime||(i.endTime=K()("".concat(K()().format("YYYY-MM-DD HH"),":00")),r.setFieldsValue({e:a}))}},needLabel:!1,form:r})),k.a.createElement(Y["a"],{sm:4},k.a.createElement(m["a"],{title:"\u786e\u8ba4\u5220\u9664\u8fd9\u4e2a\u65f6\u6bb5\u4e48\uff1f",onConfirm:function(){return F(t,e)}},k.a.createElement(V["a"],{className:q.a.dynamicDeleteButton,type:"minus-circle-o"}))))}),k.a.createElement(o["a"],{block:!0,type:"dashed",onClick:function(){return R(e)},icon:"plus-circle-o"},"\u6dfb\u52a0\u52a0\u73ed\u65f6\u6bb5")))))}),v=function(){var e=u("keys"),t=e.concat(G++);E[G-1]=[],y[G-1]=[],r.setFieldsValue({keys:t,timeRangeKeys:B()(E),exTimeRangeKeys:B()(y)})},h=function(e){var t=u("timeRangeKeys");J+=1,t[e]=t[e].concat(J),r.setFieldsValue({timeRangeKeys:B()(t)})},R=function(e){var t=u("exTimeRangeKeys");P+=1,t[e]=t[e].concat(P),r.setFieldsValue({exTimeRangeKeys:B()(t)})},S=function(e){var t=u("keys");r.setFieldsValue({keys:t.filter(function(t){return t!==e})})},C=function(e,t){var n=u("timeRangeKeys");n[t]=n[t].filter(function(t){return t!==e}),r.setFieldsValue({timeRangeKeys:B()(n)})},F=function(e,t){var n=u("exTimeRangeKeys");n[t]=n[t].filter(function(t){return t!==e}),r.setFieldsValue({exTimeRangeKeys:B()(n)})};return k.a.createElement(N["a"],{destroyOnClose:!0,afterClose:c,title:"\u65b0\u589e\u65f6\u6bb5",width:600,visible:n,onOk:d,onCancel:f,confirmLoading:l,closable:!0,maskClosable:!1,keyboard:!1,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},k.a.createElement(a["a"],{onSubmit:d,layout:"vertical"},k.a.createElement(x["a"],{gutter:24},k.a.createElement(Y["a"],{sm:24},k.a.createElement(_["a"],{config:L["a"].TEACHING.LESSON.TITLE,form:r,rules:[{required:!0}]}))),k.a.createElement(O["a"],null,T,k.a.createElement(o["a"],{block:!0,type:"dashed",onClick:function(){return v()},icon:"plus-circle-o"},"\u6dfb\u52a0\u5468\u671f"))))},U=a["a"].create()(z),Q="teachingLessonList",Z=T["a"].Text,W=function(e){var t=e.dispatch,n=e.loading,a=Object(v["a"])(!1),i=y()(a,2),r=i[0],l=i[1],f=Object(b["useState"])({periodList:[]}),E=y()(f,2),T=E[0],h=E[1],N=Object(v["a"])(!1),O=y()(N,2),x=O[0],V=O[1],Y=n.effects["".concat(Q,"/saveTimePlan")]||!1,M=n.effects["".concat(Q,"/deleteRecord")]||!1,B=function(){h({periodList:[]}),l(!0)},A=function(e){t({type:"".concat(Q,"/deleteRecord"),payload:{params:{planId:e}}}).then(function(){V(!0)})},D=[{key:"key",title:"\u5e8f\u53f7"},L["a"].TEACHING.LESSON.TITLE,p()({},L["a"].TEACHING.LESSON.PERIOD_LIST,{customRender:function(e,t){return k.a.createElement(b["Fragment"],null,JSON.parse(t.periodList).map(function(e,t){var n=e.title,a=e.dateRange;return k.a.createElement(b["Fragment"],{key:n},0!==t&&k.a.createElement(g["a"],{dashed:!0,style:{margin:"10px 0"}}),k.a.createElement("div",null,k.a.createElement(Z,{strong:!0,style:{marginRight:10}},"".concat(n,"\uff1a")),k.a.createElement("span",null,a?k.a.createElement(d["a"],{style:{marginRight:10}},a.map(function(e){return"".concat(e,"\u6708")}).join(" ~ ")):"\u6682\u65e0")))}))}}),p()({},L["a"].TEACHING.LESSON.TIME_RANGE,{customRender:function(e,t){return k.a.createElement(b["Fragment"],null,JSON.parse(t.periodList).map(function(e,t){var n=e.title,a=e.timeRange;return k.a.createElement(b["Fragment"],{key:n},0!==t&&k.a.createElement(g["a"],{dashed:!0,style:{margin:"10px 0"}}),k.a.createElement("div",null,k.a.createElement(Z,{strong:!0,style:{marginRight:10,verticalAlign:"top"}},"".concat(n,"\uff1a")),k.a.createElement("span",{style:{verticalAlign:"top",display:"inline-block",width:340}},a&&a.length>0?a.map(function(e,t){return k.a.createElement(d["a"],{key:t,style:{marginRight:10,marginBottom:10}},e.join(" ~ "))}):"\u6682\u65e0")))}))}}),p()({},L["a"].TEACHING.LESSON.EXT_TIME_RANGE,{customRender:function(e,t){return k.a.createElement(b["Fragment"],null,JSON.parse(t.periodList).map(function(e,t){var n=e.title,a=e.extTimeRange;return k.a.createElement(b["Fragment"],{key:n},0!==t&&k.a.createElement(g["a"],{dashed:!0,style:{margin:"10px 0"}}),k.a.createElement("div",null,k.a.createElement(Z,{strong:!0,style:{marginRight:10,verticalAlign:"top"}},"".concat(n,"\uff1a")),k.a.createElement("span",{style:{verticalAlign:"top",display:"inline-block",width:340}},a&&a.length>0?a.map(function(e,t){return e.length>0?k.a.createElement(d["a"],{key:t,style:{marginRight:10,marginBottom:10}},e.join(" ~ ")):"\u6682\u65e0"}):"\u6682\u65e0")))}))}}),p()({},L["a"].TEACHING.LESSON.STATUS,{customRender:function(e,n){return k.a.createElement(I["a"],{privs:["status_lession_manage"],noMatch:1===e?"\u542f\u7528":"\u5173\u95ed"},k.a.createElement(u["a"],{onChange:function(e){e?t({type:"".concat(Q,"/openTimePlan"),payload:{params:{planId:n.id}}}).then(function(){Object(H["e"])(t,"lesson_id"),V(!0)}):t({type:"".concat(Q,"/closeTimePlan"),payload:{params:{planId:n.id}}}).then(function(){Object(H["e"])(t,"lesson_id"),V(!0)})},checked:1===n[L["a"].TEACHING.LESSON.STATUS.key]}))}}),{title:"\u64cd\u4f5c",key:"action",customRender:function(e,t){var n=t.status;return[k.a.createElement(b["Fragment"],null,k.a.createElement(I["a"],{privs:["delete_lession_manage"],key:"delete_lession_manage",noMatch:"\u5220\u9664"},1*n!==1?k.a.createElement(m["a"],{key:"delete",title:"\u786e\u5b9a\u5220\u9664\u8be5\u8bfe\u65f6\u5417\uff1f",onConfirm:function(){var e=t.id;A(e)}},k.a.createElement("a",null,M&&k.a.createElement(s["a"],{size:"small"})," \u5220\u9664")):k.a.createElement(Z,{key:"delete",disabled:!0},"\u5220\u9664")),k.a.createElement(I["a"],{privs:["lesson_copy"],key:"lesson_copy"},k.a.createElement("a",{onClick:B},"\u590d\u5236")))]}}],K=[k.a.createElement(I["a"],{privs:["lession_add"],key:"lession_add"},k.a.createElement(o["a"],{key:"plus-button",icon:"plus",htmlType:"button",type:"primary",onClick:function(){B()}},"\u65b0\u589e"))];return k.a.createElement(R["a"],{title:k.a.createElement(S["FormattedMessage"],{id:"menu.teaching.lesson"})},k.a.createElement(C["a"],null,k.a.createElement(F["a"],c()({},e,{needUpdate:x,setNeedUpdate:V,pagination:!1,tableName:Q,originColumns:D,tableActions:K,columnSortable:!1,scroll:{x:"max-content"}}))),k.a.createElement(U,{loading:Y,data:T,afterClose:function(){return V(!0)},onSubmit:function(e){t({type:"".concat(Q,"/saveTimePlan"),payload:p()({},e)}).then(function(e){!1!==e&&(Object(H["e"])(t,"lesson_id"),l(!1))})},visible:r,setVisible:l}))};t["default"]=Object(h["connect"])(function(e){var t,n=e[Q],a=e.loading,i=e.global;return t={},r()(t,Q,n),r()(t,"loading",a),r()(t,"global",i),t})(a["a"].create()(W))},zYou:function(e,t,n){e.exports={dynamicDeleteButton:"antd-pro-pages-teaching-lesson-index-dynamicDeleteButton"}}}]);