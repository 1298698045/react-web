(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[133],{JQZv:function(e,t,n){"use strict";n.r(t);n("y8nQ");var a=n("Vl3Y"),i=n("eHn4"),r=n.n(i),c=n("jehZ"),o=n.n(c),l=(n("+L6B"),n("2/Rp")),u=(n("2qtc"),n("kLXV")),s=(n("Pwec"),n("CtXQ")),m=(n("BoS7"),n("Sdc0")),E=n("p0pE"),d=n.n(E),f=n("qIgq"),p=n.n(f),S=n("q1tI"),v=n.n(S),k=n("MuoO"),b=n("zHco"),y=n("Y2fQ"),g=n("v99g"),O=n("myFP"),T=n("mGJS"),h=n("9vKQ"),M=(n("14J3"),n("BMrR")),R=(n("jCWc"),n("kPKH")),L=function(e){var t=e.selectedRow,n=e.onSubmit,i=e.visible,c=e.setVisible,l=e.form,s=e.loading,m=function(e){e.preventDefault(),l.validateFields(function(e,a){if(e)return!1;n(d()({},a,r()({},h["a"].SYSTEM.ROLE.ID.key,t[h["a"].SYSTEM.ROLE.ID.key])))})},E=function(e){e.preventDefault(),c(!1)};return v.a.createElement(u["a"],{destroyOnClose:!0,title:(t[h["a"].SYSTEM.ROLE.ID.key]?"\u4fee\u6539":"\u65b0\u589e")+"\u89d2\u8272",visible:i,onOk:m,onCancel:E,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:s,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},v.a.createElement(a["a"],{onSubmit:m},v.a.createElement(M["a"],{gutter:24},[h["a"].SYSTEM.ROLE.NAME,h["a"].SYSTEM.ROLE.DESC,h["a"].SYSTEM.ROLE.STATUS].map(function(n){return v.a.createElement(R["a"],{xs:24,md:24,key:n.key},v.a.createElement(T["a"],o()({},e,{config:n,form:l,initialValue:t[n.key],rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b"}],style:{marginBottom:0}})))}))))},C=a["a"].create()(L),Y=(n("IzEo"),n("bx4M")),j=n("gWZ8"),_=n.n(j),D=(n("ozfa"),n("MJZm")),I=(D["a"].DirectoryTree,D["a"].TreeNode),w=function(e){var t=e.privEditItem,n=e.onSubmit,a=e.visible,i=e.setVisible,r=e.role,c=e.loading,o=r.privilegeTree,l=t.privsList||[],s=function e(t,n){var a=t.find(function(e){return e.privName===n});return a?a.childList&&a.childList.length:t.find(function(t){return e(t.childList,n)})},m=_()(l),E=l.filter(function(e){return!s(o,e)}),d=function(e){e.preventDefault(),n({roleId:t.id,privNameArray:m})},f=function(e){e.preventDefault(),i(!1)},p=function(e,t){var n=t.halfCheckedKeys;m=e.concat(n)},k=Object(S["useMemo"])(function(){var e=function e(t){return t.map(function(t){return v.a.createElement(I,{selectable:!1,title:t.title,key:t.privName,dataRef:t},t.childList&&e(t.childList))})};return e(o)},[o]);return v.a.createElement(u["a"],{destroyOnClose:!0,title:"\u89d2\u8272\u6743\u9650 - \u3010"+t[h["a"].SYSTEM.ROLE.NAME.key]+"\u3011",visible:a,onOk:d,onCancel:f,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:c,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88"},v.a.createElement(M["a"],{gutter:24},v.a.createElement(R["a"],{xs:24,md:24},v.a.createElement(Y["a"],{title:"\u9875\u9762\u6743\u9650"},v.a.createElement(D["a"],{checkable:!0,checkStrictly:!1,showLine:!0,onCheck:p,defaultCheckedKeys:E},k)))))},N=a["a"].create()(w),A=n("03Mi"),x=n("uY7g"),V=n("3wSE"),q="role",J=function(e){var t=e.dispatch,n=e.form,a=e.loading,i=e.role,r=Object(S["useState"])(!1),c=p()(r,2),E=c[0],f=c[1],k=Object(S["useState"])({}),M=p()(k,2),R=M[0],L=M[1],Y=Object(S["useState"])(!1),j=p()(Y,2),_=j[0],D=j[1],I=Object(S["useState"])({}),w=p()(I,2),J=w[0],P=w[1],Q=Object(S["useState"])(!1),U=p()(Q,2),B=U[0],F=U[1];Object(S["useEffect"])(function(){t({type:"".concat(q,"/queryPrivilegeTree")})},[]);var K=function(e){return t({type:"".concat(q,"/saveRole"),params:e}).then(function(){F(!0),Object(A["e"])(t,"role_id")})},Z=function(e){return t({type:"".concat(q,"/deleteRole"),params:{roleId:e[h["a"].SYSTEM.ROLE.ID.key]}}).then(function(){F(!0),Object(A["e"])(t,"role_id")})},z=function(e){return t({type:"".concat(q,"/saveRolePrivilege"),payload:{params:e}}).then(function(){F(!0),Object(A["e"])(t,"role_id")})},H=function(e,t){return K({id:e,status:t?1:0})},W=[h["a"].SYSTEM.ROLE.ID,d()({},h["a"].SYSTEM.ROLE.NAME,{customRender:function(e,t,n){return v.a.createElement(x["a"],{privs:["privs_edit"],key:"privs_edit",noMatch:e},v.a.createElement("a",{onClick:function(e){L(d()({},t)),f(!0)}},e))}}),h["a"].SYSTEM.ROLE.DESC,d()({},h["a"].SYSTEM.ROLE.STATUS,{customRender:function(e,t){return v.a.createElement(x["a"],{privs:["privs_swtich"],noMatch:1===e?"\u542f\u7528":"\u5173\u95ed"},v.a.createElement(m["a"],{checkedChildren:"\u542f\u7528",unCheckedChildren:"\u7981\u7528",checked:1==e,onChange:function(e){return H(t[h["a"].SYSTEM.ROLE.ID.key],e)}}))}}),{key:"operation",title:"\u64cd\u4f5c",customRender:function(e,t,n){return v.a.createElement(V["a"],null,v.a.createElement(x["a"],{privs:["privs_privs_setting"],key:"privs_privs_setting"},v.a.createElement("a",{key:"privilege",onClick:function(e){P(d()({},t)),D(!0)}},v.a.createElement(s["a"],{type:"setting"})," \u6743\u9650 ")),v.a.createElement(x["a"],{privs:["privs_delete"],key:"privs_delete"},v.a.createElement("a",{key:"delete",onClick:function(){return u["a"].confirm({title:"\u5220\u9664\u63d0\u793a\uff01",content:"\u786e\u5b9a\u8981\u5220\u9664\u89d2\u8272\u3010"+t[h["a"].SYSTEM.ROLE.NAME.key]+"\u3011\u5417\uff1f",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){return Z(t)}})}},v.a.createElement(s["a"],{type:"delete"})," \u5220\u9664")))}}],X=[{config:h["a"].SYSTEM.ROLE.NAME},{config:h["a"].SYSTEM.ROLE.STATUS}],G=[v.a.createElement(x["a"],{privs:["privs_add"],key:"privs_add"},v.a.createElement(l["a"],{key:"input",icon:"plus-circle",htmlType:"button",type:"primary",onClick:function(){L({}),f(!0)}},"\u65b0\u589e\u89d2\u8272"))],$=Object(S["useMemo"])(function(){return X.map(function(e){return v.a.createElement(T["a"],o()({},e,{form:n}))})},[n]);return v.a.createElement(b["a"],{title:v.a.createElement(y["FormattedMessage"],{id:"menu.system.privilege"})},v.a.createElement(g["a"],null,v.a.createElement(O["a"],o()({},e,{tableName:q,originColumns:W,formFields:$,tableActions:G,columnSortable:!1,needUpdate:B,setNeedUpdate:F}))),v.a.createElement(C,{selectedRow:R,visible:E,setVisible:f,loading:a.effects["".concat(q,"/saveRole")],onSubmit:function(e){console.log(e),K(e).then(function(e){!1!==e&&f(!1)})}}),v.a.createElement(N,{role:i,privEditItem:J,visible:_,setVisible:D,loading:a.effects["".concat(q,"/saveRolePrivilege")],onSubmit:function(e){console.log(e),z(e).then(function(e){!1!==e&&D(!1)})}}))};t["default"]=Object(k["connect"])(function(e){var t,n=e[q],a=e.loading,i=e.global;return t={},r()(t,q,n),r()(t,"loading",a),r()(t,"global",i),t})(a["a"].create()(J))}}]);