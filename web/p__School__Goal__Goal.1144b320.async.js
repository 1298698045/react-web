(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[86],{FO0s:function(e,t,a){"use strict";a.r(t);a("y8nQ");var n=a("Vl3Y"),l=a("eHn4"),r=a.n(l),o=a("jehZ"),c=a.n(o),i=(a("+L6B"),a("2/Rp")),u=a("qIgq"),s=a.n(u),d=a("q1tI"),f=a.n(d),m=a("MuoO"),g=a("zHco"),p=a("Y2fQ"),y=a("v99g"),b=a("myFP"),v=(a("9vKQ"),a("2qtc"),a("kLXV")),E=(a("g9YV"),a("wCAj")),h=(a("14J3"),a("BMrR")),k=(a("jCWc"),a("kPKH")),O=(a("OaEy"),a("2fM7")),w=(a("5NDa"),a("5rEg")),T=a("p0pE"),x=a.n(T),V=a("gWZ8"),j=a.n(V),S=(a("mGJS"),a("VgLK")),F=a.n(S),C=function(e){var t=e.availableYears,a=e.selectedRow,l=e.onSubmit,o=e.visible,c=e.setVisible,i=e.form,u=e.confirmLoading,m=e.dictionary,g=i.getFieldDecorator,p=Object(d["useState"])({}),y=s()(p,2),b=y[0],T=y[1],V=(new Date).getFullYear(),S=(new Date).getMonth()+1,C=j()(t);a.length&&a[0].year&&(C=[""+a[0].year]);for(var K=[],N=1;N<=12;++N)K.push("m"+N);for(var D=function(e){e.preventDefault(),i.validateFields(function(e,t){if(e)return!1;l(m.license_type.map(function(e){var n={year:t.year,licenseType:e.dKey};return a.find(function(t){return t.licenseType===e.dKey})&&(n.id=a.find(function(t){return t.licenseType===e.dKey}).id),K.forEach(function(a){var l="".concat(e.dKey,"-").concat(a);n[a]=t[l]}),n}))})},Y=function(e){e.preventDefault(),c(!1)},I=[{title:"\u7c7b\u578b",dataIndex:"licenseType",key:"licenseType"}],L=1;L<=12;++L)I.push({title:L+"\u6708",dataIndex:"m"+L,key:"m"+L});I.push({title:"\u5408\u8ba1",dataIndex:"total",key:"total"}),Object(d["useEffect"])(function(){if(o){var e=i.getFieldsValue(),t={};a.forEach(function(a){var n=a.licenseType,l=0;K.forEach(function(t){var a="".concat(n,"-").concat(t);l+=Number(e[a])||0}),t[n]=l}),T(t)}},[o]);var q=function(e){var t=e.target.id.split("-"),a=s()(t,2),n=a[0],l=a[1],o=i.getFieldsValue(),c=0;K.forEach(function(t){var a="".concat(n,"-").concat(t);c+=Number(t===l?e.target.value:o[a])||0}),T(x()({},b,r()({},n,c)))},G=function(){if(!m.license_type)return[];var e=m.license_type.filter(function(e){return 1==e.dictSwitch}).map(function(e){return e.dKey});return a.forEach(function(t){t.total[0]&&e.indexOf(t.licenseType)<0&&e.push(t.licenseType)}),e.map(function(e){var t={key:e,licenseType:e,total:b[e]||0};return K.forEach(function(l){var r="".concat(e,"-").concat(l),o=0;if(a.length){var c=a.find(function(t){return t.licenseType===e});c&&(o=c[l][0])}t[l]=f.a.createElement(n["a"].Item,{key:r},g(r,{initialValue:o,rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\uff01"}]})(f.a.createElement(w["a"],{style:{padding:3},disabled:V>Number(i.getFieldValue("year"))||V==Number(i.getFieldValue("year"))&&S>Number(l.substr(1)),onChange:q})))}),t})}();return f.a.createElement(v["a"],{destroyOnClose:!0,title:(a.length?"\u4fee\u6539":"\u65b0\u589e")+"\u62db\u751f\u76ee\u6807",width:"90%",visible:o,onOk:D,onCancel:Y,closable:!0,maskClosable:!1,keyboard:!1,confirmLoading:u,okText:"\u63d0\u4ea4",cancelText:"\u53d6\u6d88",className:F.a.modal},f.a.createElement(n["a"],{onSubmit:D},f.a.createElement(h["a"],{gutter:24},f.a.createElement(k["a"],{xs:24,ms:12,md:8,lg:6},f.a.createElement(n["a"].Item,null,g("year",{initialValue:C.length?C[0]:"",rules:[{required:!0,message:"\u8be5\u9879\u4e3a\u5fc5\u586b\uff01"}]})(f.a.createElement(O["a"],{placeholder:"\u8bf7\u9009\u62e9\u5e74\u4efd"},C.map(function(e){return f.a.createElement(O["a"].Option,{key:e,value:e},e,"\u5e74")})))))),f.a.createElement(h["a"],{gutter:24},f.a.createElement(k["a"],{xs:24},f.a.createElement(E["a"],{dataSource:G,columns:I,scroll:{x:"max-content"},pagination:!1})))))},K=Object(m["connect"])(function(e){var t=e.dictionary,a=e.loading,n=e.global;return{dictionary:t,loading:a,global:n}})(n["a"].create()(C)),N=a("uY7g"),D="orgGoal",Y=function(e){var t=e.dispatch,a=(e.form,e.loading),n=e[D],l=Object(d["useState"])(!1),r=s()(l,2),o=r[0],u=r[1],m=Object(d["useState"])([]),v=s()(m,2),E=v[0],h=v[1],k=Object(d["useState"])([]),O=s()(k,2),w=O[0],T=O[1],x=Object(d["useState"])(!1),V=s()(x,2),j=V[0],S=V[1],F=function(e){return t({type:"orgGoal/saveGoalEdit",payload:e}).then(function(){S(!0)})};Object(d["useEffect"])(function(){for(var e=n["".concat(D,"TableData")].list,t=[],a=(new Date).getFullYear(),l=function(a){e.find(function(e){return e.year==a})||t.push(""+a)},r=2019;r<=a+100;++r)l(r);T(t)},[n]);var C=[{key:"key",title:"\u5e8f\u53f7"},{key:"year",title:"\u5e74\u4efd"},{key:"total",title:"\u8ba1\u5212\u62db\u751f"},{key:"progress",title:"\u5b8c\u6210\u62db\u751f"},{key:"operation",title:"\u64cd\u4f5c",customRender:function(e,t,a){return f.a.createElement(N["a"],{privs:["salesgoal_detail"],noMatch:"\u67e5\u770b"},f.a.createElement("a",{onClick:function(e){h(t.list),u(!0)}},"\u67e5\u770b"))}}],Y=[f.a.createElement(N["a"],{privs:["salesgoal_add"],key:"salesgoal_add"},f.a.createElement(i["a"],{key:"input",icon:"plus-circle",htmlType:"button",type:"primary",disabled:!w.length,onClick:function(){h([]),u(!0)}},"\u65b0\u589e\u62db\u751f\u76ee\u6807"))];return f.a.createElement(g["a"],{title:f.a.createElement(p["FormattedMessage"],{id:"menu.school.goal"})},f.a.createElement(y["a"],null,f.a.createElement(b["a"],c()({},e,{tableName:D,originColumns:C,tableActions:Y,columnSortable:!1,scroll:{x:"max-content"},pagination:!1,needUpdate:j,setNeedUpdate:S}))),f.a.createElement(K,{availableYears:w,selectedRow:E,visible:o,setVisible:u,confirmLoading:a.effects["orgGoal/saveGoalEdit"],onSubmit:function(e){console.log(e),F(e).then(function(e){!1!==e&&u(!1)})}}))};t["default"]=Object(m["connect"])(function(e){var t,a=e[D],n=e.loading,l=e.global;return t={},r()(t,D,a),r()(t,"loading",n),r()(t,"global",l),t})(n["a"].create()(Y))},VgLK:function(e,t,a){e.exports={modal:"antd-pro-pages-school-goal-goal-modal"}}}]);